<link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
<script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

<df-messenger
  id="chatbot"
  project-id="presentacionchatbot"
  agent-id="930ecf76-67e4-4852-bc3c-34748e262525"
  language-code="es"
  max-query-length="-1">
  <df-messenger-chat-bubble chat-title="Poseidon Asistente Virtual"></df-messenger-chat-bubble>
</df-messenger>

<style>
  df-messenger {
    z-index: 999;
    position: fixed;
    bottom: 16px;
    right: 16px;
    --df-messenger-chat-background: #A2CADF;
    --df-messenger-message-user-background: #FFFFFF;
    --df-messenger-message-bot-background: #E6E6FA;
    --df-messenger-font-color: #333;
    --df-messenger-font-family: 'Arial', sans-serif;
    --df-messenger-button-titlebar-color: #007AFF;
  }

  df-messenger [slot="df-messenger-chat-bubble"] {
    background-color: #007AFF;
    color: #ffffff;
  }

  df-messenger [slot="df-messenger-titlebar"] {
    background-color: #007AFF;
    color: #ffffff;
  }
</style>

<script>
  // Detecta cuando el chat se abre
  window.addEventListener('dfMessengerOpen', function(event) {
    // Espera un breve momento para asegurarse de que el chat esté completamente abierto
    setTimeout(function() {
      // Selecciona el chatbot y su cuadro de entrada
      const chatInput = document.querySelector('df-messenger').shadowRoot.querySelector('df-messenger-user-input').shadowRoot.querySelector('textarea');
      
      if (chatInput) {
        // Establece el valor a "hola"
        chatInput.value = 'hola';
        // Simula el evento de "input" para que el componente lo reconozca
        chatInput.dispatchEvent(new Event('input', { bubbles: true }));

        // Encuentra el botón de enviar y lo activa
        const sendButton = document.querySelector('df-messenger').shadowRoot.querySelector('df-messenger-user-input').shadowRoot.querySelector('button');

        if (sendButton) {
          sendButton.click();
        }
      }
    }, 500); // Puedes ajustar este tiempo si es necesario
  });

  // Simula el evento de apertura de chat al hacer clic en el icono
  const chatBubble = document.querySelector('df-messenger').shadowRoot.querySelector('df-messenger-chat-bubble');

  chatBubble.addEventListener('click', function() {
    window.dispatchEvent(new Event('dfMessengerOpen'));
  });
</script>
